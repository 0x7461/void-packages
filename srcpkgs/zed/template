# Template file for 'zed'
# Uses pre-built binaries from official releases
pkgname=zed
version=0.225.10
revision=1
archs="x86_64"
wrksrc=zed.app
depends="alsa-lib fontconfig libcurl libxcb libxkbcommon libzstd openssl sqlite vulkan-loader"
short_desc="High-performance, multiplayer code editor"
maintainer="ta <ta@localhost>"
license="GPL-3.0-or-later, AGPL-3.0-or-later, Apache-2.0"
homepage="https://zed.dev"
changelog="https://github.com/zed-industries/zed/releases"
distfiles="https://github.com/zed-industries/zed/releases/download/v${version}/zed-linux-x86_64.tar.gz>zed-${version}.tar.gz"
checksum=8fa695ebb025a3d2d837795c92f3b6af4ae9f0aae1539a2ee5e71019988bc41f
nostrip=yes

do_install() {
	# zed-bin looks for ../libexec/zed-editor relative to itself,
	# so place zed-bin in usr/lib/zed/bin/ and zed-editor in usr/lib/zed/libexec/
	vinstall bin/zed 755 usr/lib/zed/bin zed-bin
	vinstall libexec/zed-editor 755 usr/lib/zed/libexec

	# Wrapper script
	vmkdir usr/bin
	cat > ${DESTDIR}/usr/bin/zed <<'EOF'
#!/bin/sh
exec /usr/lib/zed/bin/zed-bin "$@"
EOF
	chmod 755 ${DESTDIR}/usr/bin/zed

	# Bundled libraries (Zed bundles some libs for compatibility)
	vmkdir usr/lib/zed/lib
	vcopy "lib/*.so*" usr/lib/zed/lib

	# Desktop integration
	vinstall share/applications/dev.zed.Zed.desktop 644 usr/share/applications
	vinstall share/icons/hicolor/512x512/apps/zed.png 644 usr/share/icons/hicolor/512x512/apps
	vinstall share/icons/hicolor/1024x1024/apps/zed.png 644 usr/share/icons/hicolor/1024x1024/apps

	# License
	vlicense licenses.md
}
